<!DOCTYPE html>
<!--
  견적 작성 페이지
  - 고객사·상품 선택 및 기본 견적 정보를 입력하는 화면
-->
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>견적 작성 - Growth Launchpad</title>
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/quote.css">
</head>
<body class="page-quote">
  <!-- 공통 헤더 / GNB -->
  <header class="site-header">
    <a href="index.html" class="brand" aria-label="Growth Launchpad 홈">
      <div class="brand-mark" aria-hidden="true">
        <span class="m-letter">m</span>
        <span class="tm-symbol">™</span>
      </div>
      <div>
        <p class="brand-label">맑은소프트</p>
        <p class="brand-sub">Growth Launchpad</p>
      </div>
    </a>

    <button class="mobile-menu-toggle" type="button" aria-label="메인 메뉴 열기">
      ☰
    </button>

    <nav class="main-nav" aria-label="주요 메뉴">
      <button class="mobile-menu-close" type="button" aria-label="메인 메뉴 닫기">×</button>
      <a href="products.html" class="nav-pill">상품</a>
      <a href="quote.html" class="nav-pill">견적 작성</a>
      <a href="status.html" class="nav-pill">진행 현황</a>
      <a href="resources.html" class="nav-pill">자료실</a>

      <!-- 모바일 전용 추가 메뉴 -->
      <div class="main-nav-extra">
        <a href="https://www.malgnsoft.com/main/index.jsp" class="nav-pill nav-pill--secondary" target="_blank" rel="noopener noreferrer">회사소개서</a>
        <a href="https://www.malgnsoft.com/main/index.jsp" class="nav-pill nav-pill--secondary" target="_blank" rel="noopener noreferrer">대표 홈페이지</a>
        <a href="https://help.malgnsoft.com/main/index.jsp" class="nav-pill nav-pill--secondary" target="_blank" rel="noopener noreferrer">고객센터</a>
        <a href="login.html" class="nav-pill nav-pill--primary">로그인</a>
      </div>
    </nav>

    <div class="header-actions">
      <a href="https://www.malgnsoft.com/main/index.jsp" class="btn-link" target="_blank" rel="noopener noreferrer">회사소개서</a>
      <a href="https://www.malgnsoft.com/main/index.jsp" class="btn-link" target="_blank" rel="noopener noreferrer">대표 홈페이지</a>
      <a href="https://help.malgnsoft.com/main/index.jsp" class="btn-link" target="_blank" rel="noopener noreferrer">고객센터</a>
      <a href="login.html" class="btn primary">로그인</a>
      <div class="mobile-header-cta">
        <a href="login.html" class="btn primary full-width">로그인</a>
      </div>
    </div>
  </header>

  <!-- 견적 작성 폼 -->
  <main class="page-main">
    <section class="page-section page-section--no-border">
      <h1>견적 작성</h1>
      <p class="page-section-subtitle">
        고객사에 제안할 상품과 옵션을 선택하고, 견적을 생성합니다.
      </p>

      <form id="quote-form" class="form-card form-card--wide" action="#" method="post">
        <input type="hidden" id="quote-id" name="quote-id">
        
        <!-- 고객사 정보 영역 -->
        <div class="quote-section quote-section--customer">
          <h2 class="quote-section-title">고객사 정보</h2>
          
          <div class="form-grid form-grid-single-row">
            <label class="form-field">
              <span class="form-label">고객사명 <span class="required">*</span></span>
              <div class="input-with-button">
                <input type="text" id="customer-company" name="customer-company" placeholder="예: ㈜맑은테크" required>
                <button type="button" id="btn-search-customer" class="btn secondary small">고객사 검색</button>
              </div>
            </label>
            <label class="form-field">
              <span class="form-label">담당자명</span>
              <input type="text" id="customer-contact-name" name="customer-contact-name" placeholder="예: 김영업">
            </label>
            <label class="form-field">
              <span class="form-label">직책</span>
              <input type="text" id="customer-position" name="customer-position" placeholder="예: 대표이사">
            </label>
            <label class="form-field">
              <span class="form-label">연락처</span>
              <input type="tel" id="customer-phone" name="customer-phone" placeholder="예: 010-1234-5678">
            </label>
            <label class="form-field">
              <span class="form-label">이메일</span>
              <input type="email" id="customer-email" name="customer-email" placeholder="예: contact@example.com">
            </label>
          </div>
          
          <div class="form-field">
            <span class="form-label">사용 목적</span>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-school" value="학원/학교">
                <span>학원/학교</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-individual" value="개인 사업자">
                <span>개인 사업자</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-internal" value="내부 교육용">
                <span>내부 교육용</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-card" value="내일배움카드">
                <span>내일배움카드</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-public" value="공공기관 사용">
                <span>공공기관 사용</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="purpose" id="purpose-other" value="기타">
                <span>기타</span>
              </label>
            </div>
          </div>
          
          <div class="form-field">
            <span class="form-label">재격적 여부</span>
            <label class="checkbox-item">
              <input type="checkbox" name="is-requote" id="is-requote" value="재견적">
              <span>재견적</span>
            </label>
          </div>
          
          <div class="form-actions-inline">
            <button type="button" id="btn-save-customer" class="btn secondary small">고객사 정보 저장</button>
          </div>
        </div>

        <!-- 견적서 영역 -->
        <div class="quote-section quote-section--document">
          <h2 class="quote-section-title">견적서</h2>
          
          <!-- 견적서 헤더 및 회사 정보 -->
          <div class="quote-company-details">
            <div class="quote-header">
              <div class="quote-header-left">
                <div class="quote-logo">
                  <span class="quote-logo-m">m</span>
                  <span class="quote-logo-tm">™</span>
                </div>
                <div class="quote-company-info">
                  <h3 class="quote-company-name">맑은소프트</h3>
                  <p class="quote-company-slogan">보통 사람들이 만드는 위대한 기업</p>
                </div>
              </div>
              <div class="quote-header-right">
                <h1 class="quote-title">견적서</h1>
              </div>
            </div>
            <div class="quote-company-info-details">
              <p>서울특별시 구로구 디지털로 288 | tel. 02-857-5445 | fax. 02-6442-7010</p>
              <p>업태/종목_ 서비스/소프트웨어 원격교육컨텐츠개발및공급</p>
              <p>사업자등록번호 119-86-39050 | 상호 (주)맑은소프트</p>
              <p>대표자_하근호</p>
            </div>
          </div>
          
          <!-- 수신 -->
          <div class="quote-subsection">
            <h3 class="quote-subsection-title">수신</h3>
            <div class="form-grid">
              <label class="form-field">
                <span class="form-label">수신자</span>
                <input type="text" id="quote-recipient" name="recipient" placeholder="수신자를 입력하세요">
              </label>
              <label class="form-field">
                <span class="form-label">참조</span>
                <input type="text" id="quote-reference" name="reference" placeholder="참조를 입력하세요">
              </label>
            </div>
          </div>

          <!-- 견적 기본 정보 -->
          <div class="quote-subsection">
            <h3 class="quote-subsection-title">견적 기본 정보</h3>
            <div class="form-grid">
              <label class="form-field">
                <span class="form-label">견적서 제목</span>
                <input type="text" id="quote-title-input" name="quote-title" placeholder="견적서 제목을 입력하세요">
              </label>
              <label class="form-field">
                <span class="form-label">견적 일자</span>
                <input type="date" id="quote-date" name="quote-date">
              </label>
            </div>
          </div>

          <!-- 견적 항목 -->
          <div class="quote-subsection">
            <div class="quote-subsection-header">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <h3 class="quote-subsection-title" style="margin: 0;">견적 항목</h3>
                <span style="font-size: 0.85rem; color: var(--muted); font-weight: normal;">(단위 : 원, VAT 별도)</span>
              </div>
              <div class="quote-subsection-actions">
                <button type="button" id="btn-load-template" class="btn secondary small">템플릿 불러오기</button>
                <button type="button" id="btn-save-template" class="btn secondary small">템플릿 저장</button>
                <button type="button" id="btn-add-quote-item" class="btn primary small">항목 추가</button>
              </div>
            </div>
            <div class="quote-items-table">
              <table class="quote-table">
                <thead>
                  <tr>
                    <th style="width: 40px;"></th>
                    <th style="width: 250px;">구분</th>
                    <th>세부 항목</th>
                    <th style="width: 120px;">기본계약기간(월)</th>
                    <th style="width: 100px;">수량</th>
                    <th style="width: 120px;">단가</th>
                    <th style="width: 120px;">공급가액</th>
                    <th>비고</th>
                    <th style="width: 120px;">작업</th>
                  </tr>
                </thead>
                <tbody id="quote-items-body">
                  <!-- 견적 항목 행들이 여기에 동적으로 추가됩니다 -->
                </tbody>
              </table>
            </div>
            <div class="quote-items-mobile" id="quote-items-mobile">
              <!-- 모바일에서 견적 항목 카드들이 여기에 동적으로 추가됩니다 -->
            </div>
            
            <!-- 계약 총액 -->
            <div class="quote-total-section">
              <div class="quote-total-item">
                <span class="quote-total-label">계약 총액 (VAT별도)</span>
                <span class="quote-total-amount" id="quote-total-excluding-vat">0원</span>
              </div>
              <div class="quote-total-item">
                <span class="quote-total-label">계약 총액 (VAT포함)</span>
                <span class="quote-total-amount" id="quote-total-including-vat">0원</span>
              </div>
            </div>
          </div>

          <!-- 결제 및 담당자 안내 -->
          <div class="quote-subsection">
            <h3 class="quote-subsection-title">결제 및 담당자 안내</h3>
            
            <label class="form-field">
              <span class="form-label">결제정보</span>
              <input type="text" id="quote-payment-info" name="payment-info" value="신한은행 100-027-164841 예금주 (주)맑은소프트">
            </label>

            <label class="form-field">
              <span class="form-label">입금 관련</span>
              <textarea id="quote-deposit-info" name="deposit-info" rows="2">계약금은 없으며, 개발 검수 후 7일 이내 계약 총액 입금</textarea>
            </label>

            <div class="form-grid">
              <label class="form-field">
                <span class="form-label">담당자 이름</span>
                <input type="text" id="quote-manager-name" name="manager-name" readonly>
              </label>
              <label class="form-field">
                <span class="form-label">직책</span>
                <input type="text" id="quote-manager-position" name="manager-position" readonly>
              </label>
              <label class="form-field">
                <span class="form-label">연락처</span>
                <input type="tel" id="quote-manager-phone" name="manager-phone">
              </label>
              <label class="form-field">
                <span class="form-label">이메일</span>
                <input type="email" id="quote-manager-email" name="manager-email">
              </label>
            </div>

            <label class="form-field">
              <span class="form-label">유효기간</span>
              <textarea id="quote-validity" name="validity" rows="2">본 견적서의 유효 기간은 견적일자로부터 7일이며, 이후 가격정책 변경시행시 견적내용이 달라질 수 있습니다.</textarea>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn primary">견적서 생성</button>
          <button type="button" id="btn-preview" class="btn secondary">미리보기</button>
          <button type="button" id="btn-temp-save" class="btn ghost">임시 저장</button>
        </div>
      </form>
    </section>
  </main>

  <!-- 템플릿 저장 모달 -->
  <div class="modal" id="template-save-modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content--large">
      <div class="modal-header">
        <h2>템플릿 저장</h2>
        <button type="button" class="modal-close" aria-label="닫기">×</button>
      </div>
      <div class="modal-body">
        <form id="template-save-form">
          <div class="form-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 1.5rem;">
            <div class="form-field">
              <label class="form-label">견적서 종류 카테고리 <span class="required">*</span></label>
              <select id="template-save-category" class="form-input" required>
                <option value="">카테고리를 선택하세요</option>
                <option value="구축형">구축형</option>
                <option value="SaaS">SaaS</option>
                <option value="하이브리드">하이브리드</option>
                <option value="컨설팅">컨설팅</option>
                <option value="기타">기타</option>
              </select>
            </div>
            <div class="form-field">
              <label class="form-label">템플릿 이름 <span class="required">*</span></label>
              <input type="text" id="template-save-name" class="form-input" placeholder="템플릿 이름을 입력하세요" required>
            </div>
          </div>
          <div class="quote-section" style="margin-bottom: 1.5rem; border-bottom: none; padding-bottom: 0;">
            <div class="quote-subsection-header" style="margin-bottom: 1rem;">
              <h3 class="quote-subsection-title" style="margin: 0;">견적 항목</h3>
              <div class="quote-subsection-actions">
                <button type="button" id="btn-add-template-item" class="btn primary small">항목 추가</button>
              </div>
            </div>
            <div class="quote-items-table">
              <table class="quote-table">
                <thead>
                  <tr>
                    <th style="width: 40px;"></th>
                    <th style="width: 250px;">구분</th>
                    <th>세부 항목</th>
                    <th style="width: 120px;">기본계약기간(월)</th>
                    <th style="width: 100px;">수량</th>
                    <th style="width: 120px;">단가</th>
                    <th style="width: 120px;">공급가액</th>
                    <th>비고</th>
                    <th style="width: 80px;">삭제</th>
                  </tr>
                </thead>
                <tbody id="template-items-body">
                  <!-- 템플릿 항목이 여기에 동적으로 추가됩니다 -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="form-actions" style="margin-top: 1.5rem;">
            <button type="button" class="btn secondary" id="btn-template-save-cancel">취소</button>
            <button type="submit" class="btn primary">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 템플릿 수정 모달 -->
  <div class="modal" id="template-edit-modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content--extra-large">
      <div class="modal-header">
        <h2>템플릿 수정</h2>
        <button type="button" class="modal-close" aria-label="닫기">×</button>
      </div>
      <div class="modal-body">
        <form id="template-edit-form">
          <div class="form-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 1.5rem;">
            <div class="form-field">
              <label class="form-label">견적서 종류 카테고리 <span class="required">*</span></label>
              <select id="template-edit-category" class="form-input" required>
                <option value="">카테고리를 선택하세요</option>
                <option value="구축형">구축형</option>
                <option value="SaaS">SaaS</option>
                <option value="하이브리드">하이브리드</option>
                <option value="컨설팅">컨설팅</option>
                <option value="기타">기타</option>
              </select>
            </div>
            <div class="form-field">
              <label class="form-label">템플릿 이름 <span class="required">*</span></label>
              <input type="text" id="template-edit-name" class="form-input" placeholder="템플릿 이름을 입력하세요" required>
            </div>
          </div>
          <div class="quote-subsection-header" style="margin-bottom: 1rem;">
            <h3 class="quote-subsection-title" style="margin: 0;">견적 항목</h3>
            <div class="quote-subsection-actions">
              <button type="button" id="btn-add-template-edit-item" class="btn primary small">항목 추가</button>
            </div>
          </div>
          <div class="quote-items-table">
            <table class="quote-table">
              <thead>
                <tr>
                  <th style="width: 40px;"></th>
                  <th style="width: 250px;">구분</th>
                  <th>세부 항목</th>
                  <th style="width: 120px;">기본계약기간(월)</th>
                  <th style="width: 100px;">수량</th>
                  <th style="width: 120px;">단가</th>
                  <th style="width: 120px;">공급가액</th>
                  <th>비고</th>
                  <th style="width: 80px;">삭제</th>
                </tr>
              </thead>
              <tbody id="template-edit-items-body">
                <!-- 템플릿 수정 항목이 여기에 동적으로 추가됩니다 -->
              </tbody>
            </table>
          </div>
          <div class="quote-items-mobile" id="template-edit-items-mobile">
            <!-- 모바일에서 템플릿 수정 항목 카드들이 여기에 동적으로 추가됩니다 -->
          </div>
          <div class="form-actions" style="margin-top: 1.5rem;">
            <button type="button" class="btn secondary" id="btn-template-edit-cancel">취소</button>
            <button type="submit" class="btn primary">수정</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 견적 항목 템플릿 모달 -->
  <div class="modal" id="quote-template-modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content--large">
      <div class="modal-header">
        <h2>견적 항목 템플릿</h2>
        <button type="button" class="modal-close" aria-label="닫기">×</button>
      </div>
      <div class="modal-body">
        <div class="template-filter-row">
          <div class="form-field" style="margin-bottom: 0; flex: 0 0 200px;">
            <label class="form-label">카테고리 필터</label>
            <select id="template-category-filter" class="form-input">
              <option value="">전체</option>
              <option value="구축형">구축형</option>
              <option value="SaaS">SaaS</option>
              <option value="하이브리드">하이브리드</option>
              <option value="컨설팅">컨설팅</option>
              <option value="기타">기타</option>
            </select>
          </div>
          <div class="search-box" style="flex: 1; margin-bottom: 0;">
            <input type="text" id="template-search-input" class="form-input" placeholder="템플릿명을 입력하세요">
            <button type="button" id="btn-template-search" class="btn primary">검색</button>
          </div>
        </div>
        <div id="template-list-container" class="customer-list-container">
          <!-- 템플릿 리스트가 여기에 동적으로 추가됩니다 -->
        </div>
        <div id="template-list-empty" class="customer-list-empty" style="display: none;">
          <p>저장된 템플릿이 없습니다.</p>
        </div>
        <div style="margin-top: 1.5rem;">
          <button type="button" id="btn-template-delete" class="btn secondary small" style="display: none;">템플릿 삭제</button>
          <button type="button" id="btn-template-edit" class="btn secondary small" style="display: none;">템플릿 수정</button>
          <button type="button" id="btn-template-load" class="btn primary small" style="display: none;">템플릿 불러오기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 고객사 검색 모달 -->
  <div class="modal" id="customer-search-modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content--large">
      <div class="modal-header">
        <h2>고객사 검색</h2>
        <button type="button" class="modal-close" aria-label="닫기">×</button>
      </div>
      <div class="modal-body">
        <div class="search-box">
          <input type="text" id="customer-search-input" class="form-input" placeholder="고객사명을 입력하세요">
          <button type="button" id="btn-customer-search" class="btn primary">검색</button>
        </div>
        <div id="customer-list-container" class="customer-list-container">
          <!-- 고객사 리스트가 여기에 동적으로 추가됩니다 -->
        </div>
        <div id="customer-list-empty" class="customer-list-empty" style="display: none;">
          <p>검색 결과가 없습니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 견적서 미리보기 모달 -->
  <div class="modal" id="quote-preview-modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content--preview">
      <div class="quote-preview-container">
        <div class="quote-preview-paper" id="quote-preview-content">
          <!-- 견적서 내용이 여기에 동적으로 렌더링됩니다 -->
        </div>
      </div>
      <div class="quote-preview-actions">
        <button type="button" id="btn-preview-print" class="btn primary">인쇄</button>
        <button type="button" id="btn-preview-pdf" class="btn primary">PDF 저장</button>
        <button type="button" id="btn-preview-close" class="btn secondary">닫기</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // 브라우저 확장 프로그램 관련 에러 무시
    window.addEventListener('error', function(e) {
      if (e.message && e.message.includes('message channel closed')) {
        e.preventDefault();
        return false;
      }
    });
    
    // Promise rejection 관련 에러 무시
    window.addEventListener('unhandledrejection', function(e) {
      if (e.reason && e.reason.message && e.reason.message.includes('message channel closed')) {
        e.preventDefault();
        return false;
      }
    });
  </script>
  <script src="assets/js/main.js"></script>
  <script src="assets/js/products.js"></script>
  <script src="assets/js/quote.js"></script>
</body>
</html>


